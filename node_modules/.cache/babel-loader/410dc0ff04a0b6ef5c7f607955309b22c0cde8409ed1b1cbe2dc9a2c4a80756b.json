{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mohdn\\\\OneDrive\\\\Desktop\\\\mess-app-starter\\\\src\\\\UserProfilePage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { auth, db } from \"./firebase\";\nimport { doc, getDoc, updateDoc } from \"firebase/firestore\";\nimport { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from \"firebase/storage\";\nimport { updateProfile } from \"firebase/auth\";\nimport \"./UserProfilePage.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction UserProfilePage({\n  currentUser,\n  onLogout,\n  onBack\n}) {\n  _s();\n  const [userData, setUserData] = useState({\n    name: '',\n    department: '',\n    phone: '',\n    email: ''\n  });\n  const [loading, setLoading] = useState(true);\n  const [isEditing, setIsEditing] = useState(false);\n  const [avatarUrl, setAvatarUrl] = useState(\"\");\n  // Cropper state\n  const [showCropper, setShowCropper] = useState(false);\n  const [cropSrc, setCropSrc] = useState(\"\");\n  const [imgMeta, setImgMeta] = useState({\n    w: 0,\n    h: 0\n  });\n  const [zoom, setZoom] = useState(1);\n  const [offsetX, setOffsetX] = useState(0);\n  const [offsetY, setOffsetY] = useState(0);\n  const cropSize = 280; // square preview in px\n\n  // Load user data\n  useEffect(() => {\n    const loadUserData = async () => {\n      if (!currentUser) return;\n      try {\n        const userRef = doc(db, \"users\", currentUser.uid);\n        const userSnap = await getDoc(userRef);\n        if (userSnap.exists()) {\n          const data = userSnap.data();\n          setUserData({\n            name: data.name || '',\n            department: data.department || data.branch || '',\n            phone: data.phone || '',\n            email: data.email || currentUser.email || ''\n          });\n          setAvatarUrl(data.photoURL || (currentUser === null || currentUser === void 0 ? void 0 : currentUser.photoURL) || \"\");\n        }\n      } catch (error) {\n        console.error(\"Error loading user data:\", error);\n      } finally {\n        setLoading(false);\n      }\n    };\n    loadUserData();\n  }, [currentUser]);\n\n  // Handle form submission\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!currentUser) return;\n    try {\n      const userRef = doc(db, \"users\", currentUser.uid);\n      await updateDoc(userRef, {\n        name: userData.name,\n        department: userData.department,\n        phone: userData.phone\n      });\n      setIsEditing(false);\n      alert('Profile updated successfully!');\n    } catch (error) {\n      console.error(\"Error updating profile:\", error);\n      alert('Error updating profile. Please try again.');\n    }\n  };\n\n  // Handle logout\n  const handleLogout = async () => {\n    try {\n      await onLogout();\n    } catch (error) {\n      console.error(\"Error logging out:\", error);\n      alert('Error logging out. Please try again.');\n    }\n  };\n\n  // Handle input changes\n  const handleInputChange = e => {\n    const {\n      name,\n      value\n    } = e.target;\n    setUserData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  // File pick -> open cropper\n  const onPickAvatar = e => {\n    var _e$target$files;\n    const file = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = () => {\n      const src = reader.result;\n      const img = new Image();\n      img.onload = () => {\n        const w = img.naturalWidth || img.width;\n        const h = img.naturalHeight || img.height;\n        setImgMeta({\n          w,\n          h\n        });\n        setCropSrc(src);\n        // default zoom to cover the square fully\n        const initialZoom = Math.max(cropSize / w, cropSize / h);\n        setZoom(initialZoom);\n        setOffsetX(0);\n        setOffsetY(0);\n        setShowCropper(true);\n      };\n      img.src = src;\n    };\n    reader.readAsDataURL(file);\n    // allow selecting same file again\n    e.target.value = \"\";\n  };\n\n  // Compute and upload cropped blob\n  const confirmCropAndUpload = async () => {\n    if (!auth.currentUser || !cropSrc) return;\n    try {\n      // draw to canvas\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = cropSize;\n      canvas.height = cropSize;\n      const ctx = canvas.getContext(\"2d\");\n\n      // Based on preview math (draw directly, let canvas clip)\n      const imgW = imgMeta.w;\n      const imgH = imgMeta.h;\n      const dispW = imgW * zoom;\n      const dispH = imgH * zoom;\n      const left = (cropSize - dispW) / 2 + offsetX;\n      const top = (cropSize - dispH) / 2 + offsetY;\n\n      // Clear and draw (no clamping)\n      ctx.clearRect(0, 0, cropSize, cropSize);\n      const img = await loadImage(cropSrc);\n      ctx.drawImage(img, left, top, dispW, dispH);\n      const blob = await new Promise(resolve => canvas.toBlob(resolve, \"image/jpeg\", 0.9));\n\n      // Upload\n      const storage = getStorage();\n      const path = `userAvatars/${auth.currentUser.uid}`;\n      const ref = storageRef(storage, path);\n      await uploadBytes(ref, blob);\n      const url = await getDownloadURL(ref);\n      await updateDoc(doc(db, \"users\", auth.currentUser.uid), {\n        photoURL: url\n      });\n      try {\n        await updateProfile(auth.currentUser, {\n          photoURL: url\n        });\n      } catch (_) {}\n      setAvatarUrl(url);\n      setShowCropper(false);\n      alert(\"✅ Profile picture updated\");\n    } catch (err) {\n      console.error(\"Crop/upload failed\", err);\n      alert(\"❌ Failed to update profile picture\");\n    }\n  };\n  function loadImage(src) {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      img.onload = () => resolve(img);\n      img.onerror = reject;\n      img.src = src;\n    });\n  }\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"profile-container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-spinner\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"spinner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Loading profile...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"profile-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"profile-content\",\n      children: [onBack && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"back-bar\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"back-to-home-btn\",\n          onClick: onBack,\n          children: \"\\u2190 Back to Dashboard\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"profile-header\",\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          gap: 12\n        },\n        children: /*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"profile-title\",\n          children: \"User Profile\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"avatar-section\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"avatar-circle\",\n          children: [avatarUrl ? /*#__PURE__*/_jsxDEV(\"img\", {\n            src: avatarUrl,\n            alt: \"Profile\",\n            className: \"avatar-img\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 15\n          }, this) : userData.name ? userData.name.charAt(0).toUpperCase() : 'U', /*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"avatar-upload\",\n            title: \"Update profile picture\",\n            children: [\"\\uD83D\\uDCF7\", /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"file\",\n              accept: \"image/*\",\n              onChange: onPickAvatar,\n              hidden: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 9\n      }, this), showCropper && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-overlay\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"modal-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"Crop Profile Picture\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"close-btn\",\n              onClick: () => setShowCropper(false),\n              children: \"\\xD7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 221,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"modal-body\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"cropper-wrapper\",\n              style: {\n                width: cropSize,\n                height: cropSize\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"crop-viewport\",\n                style: {\n                  width: cropSize,\n                  height: cropSize\n                },\n                children: cropSrc && /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: cropSrc,\n                  alt: \"to-crop\",\n                  className: \"crop-image\",\n                  style: {\n                    width: imgMeta.w * zoom,\n                    height: imgMeta.h * zoom,\n                    transform: `translate(${(cropSize - imgMeta.w * zoom) / 2 + offsetX}px, ${(cropSize - imgMeta.h * zoom) / 2 + offsetY}px)`\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 227,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 225,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"crop-controls\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"control\",\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  children: \"Zoom\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 242,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"range\",\n                  min: \"0.5\",\n                  max: \"3\",\n                  step: \"0.01\",\n                  value: zoom,\n                  onChange: e => setZoom(parseFloat(e.target.value))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 243,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 241,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"control\",\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  children: \"Move X\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 246,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"range\",\n                  min: -cropSize * 2,\n                  max: cropSize * 2,\n                  step: \"1\",\n                  value: offsetX,\n                  onChange: e => setOffsetX(parseInt(e.target.value))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 247,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"control\",\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  children: \"Move Y\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 250,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"range\",\n                  min: -cropSize * 2,\n                  max: cropSize * 2,\n                  step: \"1\",\n                  value: offsetY,\n                  onChange: e => setOffsetY(parseInt(e.target.value))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 251,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 249,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 240,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"edit-actions\",\n              style: {\n                marginTop: 12\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"cancel-btn\",\n                onClick: () => setShowCropper(false),\n                children: \"Cancel\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 255,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"save-btn\",\n                onClick: confirmCropAndUpload,\n                children: \"Save\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        className: \"profile-form\",\n        onSubmit: handleSubmit,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"name\",\n            className: \"form-label\",\n            children: \"Name\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            id: \"name\",\n            name: \"name\",\n            value: userData.name,\n            onChange: handleInputChange,\n            className: \"form-input\",\n            placeholder: \"Enter your full name\",\n            disabled: !isEditing,\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"department\",\n            className: \"form-label\",\n            children: \"Department\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 281,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            id: \"department\",\n            name: \"department\",\n            value: userData.department,\n            onChange: handleInputChange,\n            className: \"form-input\",\n            placeholder: \"Enter your department\",\n            disabled: !isEditing,\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"phone\",\n            className: \"form-label\",\n            children: \"Phone\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 296,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"tel\",\n            id: \"phone\",\n            name: \"phone\",\n            value: userData.phone,\n            onChange: handleInputChange,\n            className: \"form-input\",\n            placeholder: \"Enter your phone number\",\n            disabled: !isEditing,\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"email\",\n            className: \"form-label\",\n            children: \"Email\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 311,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"email\",\n            id: \"email\",\n            name: \"email\",\n            value: userData.email,\n            className: \"form-input\",\n            placeholder: \"Enter your email\",\n            disabled: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-actions\",\n          children: !isEditing ? /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"edit-btn\",\n            onClick: () => setIsEditing(true),\n            children: \"Edit Profile\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"edit-actions\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"cancel-btn\",\n              onClick: () => setIsEditing(false),\n              children: \"Cancel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"save-btn\",\n              children: \"Save Changes\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 342,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"logout-section\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"logout-btn\",\n          onClick: handleLogout,\n          children: \"Logout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 355,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 186,\n    columnNumber: 5\n  }, this);\n}\n_s(UserProfilePage, \"gIzRpRMez8jz0rksy5aU4+pWvVk=\");\n_c = UserProfilePage;\nexport default UserProfilePage;\nvar _c;\n$RefreshReg$(_c, \"UserProfilePage\");","map":{"version":3,"names":["React","useState","useEffect","auth","db","doc","getDoc","updateDoc","getStorage","ref","storageRef","uploadBytes","getDownloadURL","updateProfile","jsxDEV","_jsxDEV","UserProfilePage","currentUser","onLogout","onBack","_s","userData","setUserData","name","department","phone","email","loading","setLoading","isEditing","setIsEditing","avatarUrl","setAvatarUrl","showCropper","setShowCropper","cropSrc","setCropSrc","imgMeta","setImgMeta","w","h","zoom","setZoom","offsetX","setOffsetX","offsetY","setOffsetY","cropSize","loadUserData","userRef","uid","userSnap","exists","data","branch","photoURL","error","console","handleSubmit","e","preventDefault","alert","handleLogout","handleInputChange","value","target","prev","onPickAvatar","_e$target$files","file","files","reader","FileReader","onload","src","result","img","Image","naturalWidth","width","naturalHeight","height","initialZoom","Math","max","readAsDataURL","confirmCropAndUpload","canvas","document","createElement","ctx","getContext","imgW","imgH","dispW","dispH","left","top","clearRect","loadImage","drawImage","blob","Promise","resolve","toBlob","storage","path","url","_","err","reject","onerror","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","style","display","alignItems","justifyContent","gap","alt","charAt","toUpperCase","title","type","accept","onChange","hidden","transform","min","step","parseFloat","parseInt","marginTop","onSubmit","htmlFor","id","placeholder","disabled","required","_c","$RefreshReg$"],"sources":["C:/Users/mohdn/OneDrive/Desktop/mess-app-starter/src/UserProfilePage.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { auth, db } from \"./firebase\";\r\nimport { doc, getDoc, updateDoc } from \"firebase/firestore\";\r\nimport { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from \"firebase/storage\";\r\nimport { updateProfile } from \"firebase/auth\";\r\nimport \"./UserProfilePage.css\";\r\n\r\nfunction UserProfilePage({ currentUser, onLogout, onBack }) {\r\n  const [userData, setUserData] = useState({\r\n    name: '',\r\n    department: '',\r\n    phone: '',\r\n    email: ''\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [avatarUrl, setAvatarUrl] = useState(\"\");\r\n  // Cropper state\r\n  const [showCropper, setShowCropper] = useState(false);\r\n  const [cropSrc, setCropSrc] = useState(\"\");\r\n  const [imgMeta, setImgMeta] = useState({ w: 0, h: 0 });\r\n  const [zoom, setZoom] = useState(1);\r\n  const [offsetX, setOffsetX] = useState(0);\r\n  const [offsetY, setOffsetY] = useState(0);\r\n  const cropSize = 280; // square preview in px\r\n\r\n  // Load user data\r\n  useEffect(() => {\r\n    const loadUserData = async () => {\r\n      if (!currentUser) return;\r\n      \r\n      try {\r\n        const userRef = doc(db, \"users\", currentUser.uid);\r\n        const userSnap = await getDoc(userRef);\r\n        \r\n        if (userSnap.exists()) {\r\n          const data = userSnap.data();\r\n          setUserData({\r\n            name: data.name || '',\r\n            department: data.department || data.branch || '',\r\n            phone: data.phone || '',\r\n            email: data.email || currentUser.email || ''\r\n          });\r\n          setAvatarUrl(data.photoURL || currentUser?.photoURL || \"\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error loading user data:\", error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadUserData();\r\n  }, [currentUser]);\r\n\r\n  // Handle form submission\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      const userRef = doc(db, \"users\", currentUser.uid);\r\n      await updateDoc(userRef, {\r\n        name: userData.name,\r\n        department: userData.department,\r\n        phone: userData.phone\r\n      });\r\n      \r\n      setIsEditing(false);\r\n      alert('Profile updated successfully!');\r\n    } catch (error) {\r\n      console.error(\"Error updating profile:\", error);\r\n      alert('Error updating profile. Please try again.');\r\n    }\r\n  };\r\n\r\n  // Handle logout\r\n  const handleLogout = async () => {\r\n    try {\r\n      await onLogout();\r\n    } catch (error) {\r\n      console.error(\"Error logging out:\", error);\r\n      alert('Error logging out. Please try again.');\r\n    }\r\n  };\r\n\r\n  // Handle input changes\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setUserData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n  };\r\n\r\n  // File pick -> open cropper\r\n  const onPickAvatar = (e) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      const src = reader.result;\r\n      const img = new Image();\r\n      img.onload = () => {\r\n        const w = img.naturalWidth || img.width;\r\n        const h = img.naturalHeight || img.height;\r\n        setImgMeta({ w, h });\r\n        setCropSrc(src);\r\n        // default zoom to cover the square fully\r\n        const initialZoom = Math.max(cropSize / w, cropSize / h);\r\n        setZoom(initialZoom);\r\n        setOffsetX(0);\r\n        setOffsetY(0);\r\n        setShowCropper(true);\r\n      };\r\n      img.src = src;\r\n    };\r\n    reader.readAsDataURL(file);\r\n    // allow selecting same file again\r\n    e.target.value = \"\";\r\n  };\r\n\r\n  // Compute and upload cropped blob\r\n  const confirmCropAndUpload = async () => {\r\n    if (!auth.currentUser || !cropSrc) return;\r\n    try {\r\n      // draw to canvas\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = cropSize;\r\n      canvas.height = cropSize;\r\n      const ctx = canvas.getContext(\"2d\");\r\n\r\n      // Based on preview math (draw directly, let canvas clip)\r\n      const imgW = imgMeta.w;\r\n      const imgH = imgMeta.h;\r\n      const dispW = imgW * zoom;\r\n      const dispH = imgH * zoom;\r\n      const left = (cropSize - dispW) / 2 + offsetX;\r\n      const top = (cropSize - dispH) / 2 + offsetY;\r\n\r\n      // Clear and draw (no clamping)\r\n      ctx.clearRect(0, 0, cropSize, cropSize);\r\n      const img = await loadImage(cropSrc);\r\n      ctx.drawImage(img, left, top, dispW, dispH);\r\n\r\n      const blob = await new Promise((resolve) => canvas.toBlob(resolve, \"image/jpeg\", 0.9));\r\n\r\n      // Upload\r\n      const storage = getStorage();\r\n      const path = `userAvatars/${auth.currentUser.uid}`;\r\n      const ref = storageRef(storage, path);\r\n      await uploadBytes(ref, blob);\r\n      const url = await getDownloadURL(ref);\r\n      await updateDoc(doc(db, \"users\", auth.currentUser.uid), { photoURL: url });\r\n      try { await updateProfile(auth.currentUser, { photoURL: url }); } catch (_) {}\r\n      setAvatarUrl(url);\r\n      setShowCropper(false);\r\n      alert(\"✅ Profile picture updated\");\r\n    } catch (err) {\r\n      console.error(\"Crop/upload failed\", err);\r\n      alert(\"❌ Failed to update profile picture\");\r\n    }\r\n  };\r\n\r\n  function loadImage(src) {\r\n    return new Promise((resolve, reject) => {\r\n      const img = new Image();\r\n      img.onload = () => resolve(img);\r\n      img.onerror = reject;\r\n      img.src = src;\r\n    });\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"profile-container\">\r\n        <div className=\"loading-spinner\">\r\n          <div className=\"spinner\"></div>\r\n          <p>Loading profile...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"profile-container\">\r\n      <div className=\"profile-content\">\r\n        {/* Back to Dashboard (prominent) */}\r\n        {onBack && (\r\n          <div className=\"back-bar\">\r\n            <button className=\"back-to-home-btn\" onClick={onBack}>\r\n              ← Back to Dashboard\r\n            </button>\r\n          </div>\r\n        )}\r\n        {/* Header */}\r\n        <div className=\"profile-header\" style={{display:'flex', alignItems:'center', justifyContent:'center', gap:12}}>\r\n          <h1 className=\"profile-title\">User Profile</h1>\r\n        </div>\r\n\r\n        {/* Avatar Section */}\r\n        <div className=\"avatar-section\">\r\n          <div className=\"avatar-circle\">\r\n            {avatarUrl ? (\r\n              <img src={avatarUrl} alt=\"Profile\" className=\"avatar-img\" />\r\n            ) : (\r\n              (userData.name ? userData.name.charAt(0).toUpperCase() : 'U')\r\n            )}\r\n            <label className=\"avatar-upload\" title=\"Update profile picture\">\r\n              📷\r\n              <input type=\"file\" accept=\"image/*\" onChange={onPickAvatar} hidden />\r\n            </label>\r\n          </div>\r\n        </div>\r\n\r\n        {showCropper && (\r\n          <div className=\"modal-overlay\">\r\n            <div className=\"modal-content\">\r\n              <div className=\"modal-header\">\r\n                <h2>Crop Profile Picture</h2>\r\n                <button className=\"close-btn\" onClick={() => setShowCropper(false)}>×</button>\r\n              </div>\r\n              <div className=\"modal-body\">\r\n                <div className=\"cropper-wrapper\" style={{ width: cropSize, height: cropSize }}>\r\n                  <div className=\"crop-viewport\" style={{ width: cropSize, height: cropSize }}>\r\n                    {cropSrc && (\r\n                      <img\r\n                        src={cropSrc}\r\n                        alt=\"to-crop\"\r\n                        className=\"crop-image\"\r\n                        style={{\r\n                          width: imgMeta.w * zoom,\r\n                          height: imgMeta.h * zoom,\r\n                          transform: `translate(${(cropSize - imgMeta.w * zoom) / 2 + offsetX}px, ${(cropSize - imgMeta.h * zoom) / 2 + offsetY}px)`\r\n                        }}\r\n                      />\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"crop-controls\">\r\n                  <div className=\"control\">\r\n                    <label>Zoom</label>\r\n                    <input type=\"range\" min=\"0.5\" max=\"3\" step=\"0.01\" value={zoom} onChange={(e)=>setZoom(parseFloat(e.target.value))} />\r\n                  </div>\r\n                  <div className=\"control\">\r\n                    <label>Move X</label>\r\n                    <input type=\"range\" min={-cropSize*2} max={cropSize*2} step=\"1\" value={offsetX} onChange={(e)=>setOffsetX(parseInt(e.target.value))} />\r\n                  </div>\r\n                  <div className=\"control\">\r\n                    <label>Move Y</label>\r\n                    <input type=\"range\" min={-cropSize*2} max={cropSize*2} step=\"1\" value={offsetY} onChange={(e)=>setOffsetY(parseInt(e.target.value))} />\r\n                  </div>\r\n                </div>\r\n                <div className=\"edit-actions\" style={{marginTop: 12}}>\r\n                  <button type=\"button\" className=\"cancel-btn\" onClick={()=>setShowCropper(false)}>Cancel</button>\r\n                  <button type=\"button\" className=\"save-btn\" onClick={confirmCropAndUpload}>Save</button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Profile Form */}\r\n        <form className=\"profile-form\" onSubmit={handleSubmit}>\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"name\" className=\"form-label\">Name</label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"name\"\r\n              name=\"name\"\r\n              value={userData.name}\r\n              onChange={handleInputChange}\r\n              className=\"form-input\"\r\n              placeholder=\"Enter your full name\"\r\n              disabled={!isEditing}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"department\" className=\"form-label\">Department</label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"department\"\r\n              name=\"department\"\r\n              value={userData.department}\r\n              onChange={handleInputChange}\r\n              className=\"form-input\"\r\n              placeholder=\"Enter your department\"\r\n              disabled={!isEditing}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"phone\" className=\"form-label\">Phone</label>\r\n            <input\r\n              type=\"tel\"\r\n              id=\"phone\"\r\n              name=\"phone\"\r\n              value={userData.phone}\r\n              onChange={handleInputChange}\r\n              className=\"form-input\"\r\n              placeholder=\"Enter your phone number\"\r\n              disabled={!isEditing}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"email\" className=\"form-label\">Email</label>\r\n            <input\r\n              type=\"email\"\r\n              id=\"email\"\r\n              name=\"email\"\r\n              value={userData.email}\r\n              className=\"form-input\"\r\n              placeholder=\"Enter your email\"\r\n              disabled\r\n            />\r\n          </div>\r\n\r\n          {/* Action Buttons */}\r\n          <div className=\"form-actions\">\r\n            {!isEditing ? (\r\n              <button\r\n                type=\"button\"\r\n                className=\"edit-btn\"\r\n                onClick={() => setIsEditing(true)}\r\n              >\r\n                Edit Profile\r\n              </button>\r\n            ) : (\r\n              <div className=\"edit-actions\">\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"cancel-btn\"\r\n                  onClick={() => setIsEditing(false)}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"save-btn\"\r\n                >\r\n                  Save Changes\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </form>\r\n\r\n        {/* Logout Button */}\r\n        <div className=\"logout-section\">\r\n          <button\r\n            className=\"logout-btn\"\r\n            onClick={handleLogout}\r\n          >\r\n            Logout\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default UserProfilePage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}